{% extends 'base.html' %}
{% load static custom_filters %}

{% block styles %}
{% endblock styles %}
                
{% block content %}

{% if informes_recepcion|length == 0 %}    
<p class="flex justify-center font-bold text-xl mt-24 text-gray-800 dark:text-gray-100">
    <svg class="w-6 h-6 mr-2" aria-hidden="true" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.143 17.082a24.248 24.248 0 003.844.148m-3.844-.148a23.856 23.856 0 01-5.455-1.31 8.964 8.964 0 002.3-5.542m3.155 6.852a3 3 0 005.667 1.97m1.965-2.277L21 21m-4.225-4.225a23.81 23.81 0 003.536-1.003A8.967 8.967 0 0118 9.75V9A6 6 0 006.53 6.53m10.245 10.245L6.53 6.53M3 3l3.53 3.53"></path>
    </svg>
    No han informes de recepción por confirmar
</p>
{% endif %}

<div class="flex flex-col items-center p-12 w-full">
    {% for ir in informes_recepcion %}
    <form method="POST" class="flex flex-col w-full max-w-5xl">
        {% csrf_token %}
        <input type="number" step="0.01" step-my  name="informe-recepcion-id" value={{ ir.id }} class="hidden" />
        <div class="flex flex-col bg-white shadow-md">
            <div class="flex">
                <div class="flex w-1/2">
                    <span class="w-1/5 border text-sm text-center font-bold">RE</br>CEP</br>TOR</span>
                    <div class="w-4/5 flex flex-col">
                        <span class="border border-b h-full text-xs px-2">Entidad: Casa Laura S.R.L. </br>Codigo: 50004347244</span>
                        <div class="flex border h-full px-2">
                            Almacén:  {{ ir.almacen }}
                        </div>
                    </div>
                </div>
                <div class="flex w-1/2">
                    <div class="w-2/3 border h-full font-bold flex items-center justify-center">Informe de Recepción</div>
                    <div class="w-1/3 border flex">
                        <div class="w-1/3 flex flex-col">
                            <div class="border-b h-full text-center font-bold">D</div>
                            <div class="h-full text-center" id="dia">{{ir.fecha|date:"d"}}</div>
                        </div>
                        <div class="w-1/3 border-l flex flex-col">
                            <div class="border-b h-full text-center font-bold">M</div>
                            <div class="h-full text-center" id="mes">{{ir.fecha|date:"m"}}</div>
                        </div>
                        <div class="w-1/3 border-l flex flex-col">
                            <div class="border-b h-full text-center font-bold">A</div>
                            <div class="h-full text-center" id="anno">{{ir.fecha|date:"y"}}</div>
                        </div>
                    </div>
                </div>
            </div>            
            <div class="flex">
                <span class="w-3/6 border h-full px-2.5">Proveedor:</br> {{ ir.proveedor }}</span>
                <span class="w-1/6 border h-full px-2.5">Codigo:</br> {{ ir.codigo }}</span>
                <span class="w-1/6 border h-full px-2.5">Factura:</br> {{ ir.factura }}</span>
                <span class="w-1/6 border h-full px-2.5">Conduce:</br> {{ ir.conduce }}</span>
            </div>
            <div class="flex">
                <span class="w-1/5 border h-full px-2.5">Contrato:</br> {{ ir.contrato }}</span>
                <span class="w-1/5 border h-full px-2.5">Manifiesto:</br> {{ ir.manifiesto }}</span>
                <span class="w-1/5 border h-full px-2.5">Partida:</br> {{ ir.partida }}</span>
                <span class="w-1/5 border h-full px-2.5">Embarque:</br> {{ ir.conoc_embarque }}</span>
                <span class="w-1/5 border h-full px-2.5">Expedicion:</br> {{ ir.orden_expedicion }}</span>
            </div>
            <div class="flex">
                <span class="w-2/4 border h-full px-2.5">Transportador:</br> {{ ir.transportador }}</span>
                <span class="w-1/4 border h-full px-2.5">Carne de identidad:</br> {{ ir.carne_identidad }}</span>
                <span class="w-1/4 border h-full px-2.5">Chapa:</br> {{ ir.chapa }}</span>
                
            </div>

            

            <div class="flex">
                <div class="flex w-1/2">
                    <span class="w-1/6 border h-full text-sm font-semibold text-center flex items-center justify-center">Código</span>
                    <span class="w-3/6 border h-full text-sm font-semibold text-center flex items-center justify-center">Descripción</span>
                    <span class="w-1/6 border h-full text-sm font-semibold text-center flex items-center justify-center">U/M</span>
                    <span class="w-1/6 border h-full text-sm font-semibold text-center flex items-center justify-center">F.V</span>
                </div>
                <div class="flex w-1/2">
                    <div class="flex w-1/2 h-full">
                        <span class="w-1/3 border h-full text-sm font-semibold text-center flex items-center justify-center">Cantidad</span>
                        <span class="w-2/3 border h-full text-sm font-semibold text-center">Precio </br> unitario total</span>
                    </div>
                    <div class="flex w-1/2">
                        <span class="w-2/3 border h-full text-sm font-semibold text-center flex items-center justify-center">Importe</span>
                        <span class="w-1/3 border h-full text-sm font-semibold text-center">Saldo en </br> existencia</span>
                    </div>
                </div>
            </div>
            
            <div class="" id="content-products">
                {% for item in ir.productos %}                
                <div class="flex">
                    <input type="number" step="0.01" step-my  name="almacen-id" value={{ item.id }} class="hidden" />
                    <div class="flex w-1/2">
                        <span class="flex w-1/6 border text-center">
                            {% if item.cantidad_inicial == item.cantidad_factura %}
                            <svg class="w-5 h-5 text-transparent mx-2 mt-0.5" aria-hidden="true" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z"></path>
                            </svg>
                            {% else %}
                            <svg data-popover-target="popover-alert-{{item.id}}" class="w-5 h-5 mt-0.5 text-red-400 mx-2 cursor-pointer" aria-hidden="true" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"></path>
                            </svg>
                            <div data-popover id="popover-alert-{{item.id}}" role="tooltip" class="absolute z-10 invisible inline-block w-auto text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 dark:text-gray-400 dark:border-gray-600 dark:bg-gray-800">
                                <div class="px-3 py-2 bg-gray-100 border-b border-gray-200 rounded-t-lg dark:border-gray-600 dark:bg-gray-700">
                                    <h3 class="font-semibold text-gray-900 dark:text-white">Alerta</h3>
                                </div>
                                <div class="px-3 py-2">
                                    <p class="text-start">Cantidad en factura: {{ item.cantidad_factura|parseFloat }} {{ item.producto.medida.abreviatura }}</p>
                                    <p class="text-start">Cantidad recepcionada: {{ item.cantidad_inicial|parseFloat }} {{ item.producto.medida.abreviatura }}</p>
                                </div>
                                <div data-popper-arrow></div>
                            </div>
                            {% endif %}
                            {{ item.producto.codigo }}
                        </span>
                        <span class="w-3/6 border text-center">{{ item.producto.nombre }}</span>
                        <span class="w-1/6 border text-center">{{ item.producto.medida }}</span>
                        <span class="w-1/6 border text-center">{{ item.vencimiento }}</span>
                    </div>
                    <div class="flex w-1/2 border">
                        <div class="flex w-1/2 h-full border-r">
                            <span class="w-1/3 border-r text-center">{{ item.cantidad_inicial|parseFloat }}</span>
                            <div class="flex w-2/3 border-l">
                                {% with item.costo_cup|toMoneyList as precio_venta_list %}
                                <span class="w-3/5 text-center h-full">{{ precio_venta_list.0 }}</span>
                                <span class="w-0.5 bg-gray-200"></span>
                                <span class="w-2/5 text-center h-full">{{ precio_venta_list.1 }}</span>
                                {% endwith %}
                            </div>
                        </div>
                        <div class="flex w-1/2">
                            <div class="flex w-2/3 border-l">
                                {% with item.importe_inicial|toMoneyList as importe_inicial_list %}
                                <span class="w-3/5 text-center h-full">{{ importe_inicial_list.0 }}</span>
                                <span class="w-0.5 bg-gray-200"></span>
                                <span class="w-2/5 text-center h-full">{{ importe_inicial_list.1 }}</span>
                                {% endwith %}
                            </div>
                            <span class="w-1/3 h-full text-sm text-center border-l-2">-</span>
                            <span class="hidden w-1/3 h-full text-sm text-center border-l-2">
                                {% if item.producto.existencia  %}
                                {% with existencia=item.cantidad_inicial|add:item.producto.existencia %}
                                    {{ existencia|parseFloat }}
                                {% endwith %}
                                {% elif item.cantidad_inicial %}{{ item.cantidad_inicial|parseFloat }}
                                {% else %}0{% endif %}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
              

            <div class="flex w-full">
                <span class="w-1/2 px-2.5 border-t border-b border-l">Importe total de la recepción</span>
                <div class="flex w-1/2 border-t">
                    <div class="w-1/2 border-r border-b"></div>
                    <div class="flex w-1/2 border-r">
                        <div class="flex w-2/3 border-l border-b">
                            {% with ir.productos|sum_importe_inicial as precio_venta_list %}
                            <span class="w-3/5 text-center h-full">{{ precio_venta_list.0 }}</span>
                            <span class="w-0.5 bg-gray-200"></span>
                            <span class="w-2/5 text-center h-full">{{ precio_venta_list.1 }}</span>
                            {% endwith %}
                        </div>
                        <span class="text-sm px-1 w-1/3 border-l-2"><span class="text-red-500"></span>No.</span>
                    </div>
                </div>
            </div>            
            <div class="flex">
                <div class="flex w-11/12">
                    <span class="w-1/5 border h-full px-2.5">J' Almacén:</br></span>
                    <span class="w-1/5 border h-full px-2.5">Transportador:</br></span>
                    <span class="w-1/5 border h-full px-2.5">Recepcionado:</br></span>
                    <span class="w-1/5 border h-full px-2.5">Contabilizado:</br></span>
                    <span class="w-1/5 border h-full text-sm px-2">Anotado control de inventario</span>
                </div>
                <div class="flex flex-col w-1/12 border-t-0 border-l  border-r border-b">
                </div>
            </div>

        </div>
        <div class="flex mt-3 justify-end">
            <button type="submit" class="focus:outline-none text-white bg-purple-600 hover:bg-purple-800 focus:ring-4 focus:ring-purple-300 font-medium rounded-lg text-sm px-5 py-2.5 mb-2 dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-900">Confirmar Recepcion</button>
        </div>
    </form>
    {% endfor %}
</div>


{% endblock content %}


{% block scripts %}
{% endblock scripts %}
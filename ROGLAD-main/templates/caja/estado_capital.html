{% extends 'caja/base.html' %}
{% load static custom_filters %}


{% block contentFilter %}
<form date-rangepicker class="flex h-auto bg-white w-full border-t mb-0 pt-0.5 mt-0.5" method="GET">
    <div class="relative w-1/3 border-r">
        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
            <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path></svg>
        </div>
        <input name="inicio" value="{{inicio}}" type="text" class="border-0 text-gray-900 text-sm rounded-lg focus:ring-0 focus:border-0 block w-full pl-10 p-2.5" placeholder="Desde">
    </div>
    <div class="relative w-1/3">
        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
            <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"></path></svg>
        </div>
        <input name="fin" type="text" value="{{fin}}" class="border-0 text-gray-900 text-sm rounded-lg focus:ring-0 focus:border-0 block w-full pl-10 p-2.5" placeholder="Hasta">
    </div>  
    <button class="w-1/3 flex items-center justify-center  p-2.5 text-sm font-medium leading-5 text-gray-600 hover:text-gray-800 shadow-sm hover:shadow-lg bg-gray-200 hover:bg-gray-300 border border-transparent rounded-lg focus:outline-none focus:shadow-outline-gray" type="submit">
        <svg class="w-5 h-5 mr-2" aria-hidden="true" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 01-.659 1.591l-5.432 5.432a2.25 2.25 0 00-.659 1.591v2.927a2.25 2.25 0 01-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 00-.659-1.591L3.659 7.409A2.25 2.25 0 013 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0112 3z"></path>
        </svg>
        Filtrar historial de recibos
    </button>
</form>
{% endblock contentFilter %}


{% block contentCaja %}
<div class="w-full bg-white rounded-lg shadow dark:bg-gray-800 p-4 md:p-6">
    <div class="w-full flex flex-wrap justify-between items-center space-x-4">
        
        <h1 class="p-6 font- flex-1">Variación del estado del capital a lo largo del período seleccionado:</h1>
        <div class="flex flex-col items-center">
            <h5 class="inline-flex items-center text-gray-500 dark:text-gray-400 leading-none font-normal mb-2">Monto total:</h5>
            <p class="text-gray-900 dark:text-white text-2xl leading-none font-bold">${{total|add:total_liquides|toMoney}}</p>
        </div>
        <div class="flex flex-col items-center">
            <h5 class="inline-flex items-center text-gray-500 dark:text-gray-400 leading-none font-normal mb-2">Monto en capital:</h5>
            <p class="text-gray-900 dark:text-white text-2xl leading-none">${{total|toMoney}}</p>
        </div>
        <div class="flex flex-col items-center ">
            <h5 class="inline-flex items-center text-gray-500 dark:text-gray-400 leading-none font-normal mb-2">Monto en caja:</h5>
            <p class="text-gray-900 dark:text-white text-2xl leading-none">${{total_liquides|toMoney}}</p>
        </div>
        
    </div>

    <div class="h-64"><div id="line-chart" class=""></div></div>
    
    <h1 class="p-6 font- flex-1 mt-12">Variación del estado del capital y estado de liquides en caja:</h1>
    
    <div class="h-64"><div id="line-chart-2" class=""></div></div>
    
</div>
{% endblock contentCaja %}


{% block scripts %}

    <script src="{% static 'js/apexcharts.js' %}"></script>
    <script >
        const options = {
            xaxis: {
              show: true,
              categories: [{% for fecha in fechas %}"{{fecha|date:"d/m/Y"}}",{% endfor %}],
              labels: {
                show: true,
                style: {
                  fontFamily: "Inter, sans-serif",
                  cssClass: 'text-xs font-normal fill-gray-500 dark:fill-gray-400'
                }
              },
              axisBorder: {
                show: false,
              },
              axisTicks: {
                show: false,
              },
            },
            yaxis: {
              show: true,
              labels: {
                show: true,
                style: {
                  fontFamily: "Inter, sans-serif",
                  cssClass: 'text-xs font-normal fill-gray-500 dark:fill-gray-400'
                },
                formatter: function (value) {
                  return '$' + value;
                }
              }
            },
            grid: {
              show: true,
              strokeDashArray: 4,
              padding: {
                left: 2,
                right: 2,
                top: -12
              },
            },
            series: [
                {% for s in series %}
                {
                    name: "{{s.name}}",
                    data: {{s.data}},
                    color: "{{s.color}}",
                },
                {% endfor %}
            ],
            chart: {
              sparkline: {
                enabled: false
              },
              height: "100%",
              width: "100%",
              type: "area",
              fontFamily: "Inter, sans-serif",
              dropShadow: {
                enabled: false,
              },
              toolbar: {
                show: false,
              },
            },
            tooltip: {
              enabled: true,
              x: {
                show: false,
              },
            },
            fill: {
              type: "gradient",
              gradient: {
                opacityFrom: 0.55,
                opacityTo: 0,
                shade: "#1C64F2",
                gradientToColors: ["#1C64F2"],
              },
            },
            dataLabels: {
              enabled: false,
            },
            stroke: {
              width: 5,
            },
            legend: {
              show: false
            },
        }
        
        const options2 = {
            xaxis: {
              show: true,
              categories: [{% for fecha in fechas %}"{{fecha|date:"d/m/Y"}}",{% endfor %}],
              labels: {
                show: true,
                style: {
                  fontFamily: "Inter, sans-serif",
                  cssClass: 'text-xs font-normal fill-gray-500 dark:fill-gray-400'
                }
              },
              axisBorder: {
                show: false,
              },
              axisTicks: {
                show: false,
              },
            },
            yaxis: {
              show: true,
              labels: {
                show: true,
                style: {
                  fontFamily: "Inter, sans-serif",
                  cssClass: 'text-xs font-normal fill-gray-500 dark:fill-gray-400'
                },
                formatter: function (value) {
                  return '$' + value;
                }
              }
            },
            grid: {
              show: true,
              strokeDashArray: 4,
              padding: {
                left: 2,
                right: 2,
                top: -12
              },
            },
            series: [
                {% for s in series2 %}
                {
                    name: "{{s.name}}",
                    data: {{s.data}},
                    color: "{{s.color}}",
                },
                {% endfor %}
            ],
            chart: {
              sparkline: {
                enabled: false
              },
              height: "100%",
              width: "100%",
              type: "area",
              fontFamily: "Inter, sans-serif",
              dropShadow: {
                enabled: false,
              },
              toolbar: {
                show: false,
              },
            },
            tooltip: {
              enabled: true,
              x: {
                show: false,
              },
            },
            fill: {
              type: "gradient",
              gradient: {
                opacityFrom: 0.55,
                opacityTo: 0,
                shade: "#1C64F2",
                gradientToColors: ["#1C64F2"],
              },
            },
            dataLabels: {
              enabled: false,
            },
            stroke: {
              width: 5,
            },
            legend: {
              show: false
            },
        }

        if (document.getElementById("line-chart") && typeof ApexCharts !== 'undefined') {
            const chart = new ApexCharts(document.getElementById("line-chart"), options);
            chart.render();
            
            const chart2 = new ApexCharts(document.getElementById("line-chart-2"), options2);
            chart2.render();
        }



    </script>  
{% endblock scripts %}
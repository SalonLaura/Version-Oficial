{% extends 'cocina/base.html' %}
{% load static custom_filters %}

{% block styles %}
{% endblock styles %}
                
{% block content %}



<div class="flex flex-col items-center p-12 w-full">  
    <ul class="mb-3 text-sm font-medium text-center text-gray-500 rounded-lg shadow w-full max-w-6xl min-w-5xl flex space-x-1 dark:text-gray-400 p-0.5 bg-white">
        <li class="w-full">
            <a href="{% url 'TransferenciaCocina' action='get' %}" class="inline-block w-full p-4 hover:text-gray-700 rounded-lg hover:bg-gray-100 focus:ring-0 focus:outline-none dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700" aria-current="page">Transferencias Recibidas</a>
        </li>
        <li class="w-full">
            <a href="{% url 'TransferenciaCocina' action='post' %}" class="inline-block w-full p-4 hover:text-gray-700 rounded-lg hover:bg-gray-100 focus:ring-0 focus:outline-none dark:hover:text-white dark:bg-gray-800 dark:hover:bg-gray-700" aria-current="page">Transferencias Realizadas</a>
        </li>
        <li class="w-full">
            <a href="{% url 'NuevaTransferenciaCocina' %}" class="inline-block w-full p-4 text-gray-900 bg-purple-200 rounded-lg focus:ring-0 active focus:outline-none dark:bg-gray-700 dark:text-white">Nueva Transferencia</a>
        </li>
    </ul>

    {% if productos|length > 0 %}
    <p class="w-full text-center font-bold">Transferir platos elaborados a Punto de venta</p>
    <form method="POST" class="flex flex-col w-full max-w-6xl min-w-5xl" id="form-nueva-transferencia">
        {% csrf_token %}
        <div class="flex flex-col bg-purple-200 shadow-md">
            <div class="flex">
                <span class="w-2/6 border h-full text-md px-2 py-1">Entidad: </br>Casa Laura S.R.L.</span>
                <span class="w-1/6 border h-full text-md px-2 py-1">Codigo: </br>50004347244</span>
                <span class="w-2/6 border h-full text-center font-bold py-1">SC-2-09 TRANSFERENCIA ENTRE </br> ALMACENES</span>
                <div class="w-1/6 border flex">
                    <div class="w-1/3 flex flex-col">
                        <div class="border-b h-full text-center font-bold">D</div>
                        <div class="h-full text-center" id="dia"></div>
                    </div>
                    <div class="w-1/3 border-l flex flex-col">
                        <div class="border-b h-full text-center font-bold">M</div>
                        <div class="h-full text-center" id="mes"></div>
                    </div>
                    <div class="w-1/3 border-l flex flex-col">
                        <div class="border-b h-full text-center font-bold">A</div>
                        <div class="h-full text-center" id="anno"></div>
                    </div>
                </div>
            </div>
            
            <div class="flex">
                <div class="px-2.5 py-1 flex w-1/3 border h-full items-center relative h-full">
                    <span class="text-red-500 mr-1">*</span>
                    Entrega:
                    <input type="text" id="emisor" name="emisor" class="hidden" value="C-{{emisor.id}}">
                    <span class="block px-2.5 w-full border-0 text-sm text-gray-900">{{emisor.nombre}}</span>

                </div>
                <span class="flex w-1/3 py-1 px-2.5 border h-full">{% if emisor.direccion %}{{ emisor.direccion }}{% else %}Dirección{% endif %}</span>
                <span class="flex w-1/3 py-1 px-2.5 border h-full">{% if emisor.codigo %}{{ emisor.codigo }}{% else %}Código{% endif %}</span>
            </div>
            
            <div class="flex">
                <div class="px-2.5 py-1 flex w-1/3 border h-full items-center relative h-full">
                    <span class="text-red-500 mr-1">*</span>
                    Recibe:                    
                    <select id="receptor" name="receptor" required class="block px-2.5 w-full border-0 text-sm text-gray-900 bg-transparent appearance-none focus:outline-none focus:ring-0">
                        
                        <option disabled selected value="">Puntos de venta</option>
                        {% for pv in puntos_ventas %}
                        <option value="PV-{{ pv.id }}">{{ pv.nombre }}</option>
                        {% endfor %}
                    </select>

                </div>
                <span class="flex w-1/3 py-1 px-2.5 border h-full">Dirección</span>
                <span class="flex w-1/3 py-1 px-2.5 border h-full">Código</span>
            </div>
            
            <div class="flex">
                <div class="flex w-1/3">
                    <span class="w-2/5 border h-full text-sm font-semibold text-center flex items-center justify-center">Código</span>
                    <span class="w-2/5 border h-full text-sm font-semibold text-center flex items-center justify-center">Descripción</span>
                    <span class="w-1/5 border h-full text-sm font-semibold text-center flex items-center justify-center">U/M</span>
                </div>
                <div class="flex w-1/3">
                    <div class="flex flex-col w-1/2 h-full">
                        <span class="w-full border h-full text-sm font-semibold text-center">Cantidad</span>
                        <div class="flex w-full h-full">
                            <span class="w-1/2 border h-full text-sm font-semibold text-center">Remitida</span>
                            <span class="w-1/2 border h-full text-sm font-semibold text-center">Recibida</span>
                        </div>
                    </div>
                    <span class="w-1/2 border h-full text-sm font-semibold text-center">Precio Unitario </br> Total o Costo </br> Predeterminado</span>
                </div>
                <div class="flex w-1/3">
                    <div class="flex flex-col w-2/3 h-full">
                        <span class="w-full border h-full text-sm font-semibold text-center">Importe</span>
                        <div class="flex w-full h-full">
                            <span class="w-1/2 border h-full text-sm font-semibold text-center">Productos</br>Remitidos</span>
                            <span class="w-1/2 border h-full text-sm font-semibold text-center">Productos</br>Recibidos</span>
                        </div>
                    </div>
                    <span class="w-1/3 border h-full text-sm font-semibold text-center flex items-center justify-center">Saldo en </br> Existencia</span>
                </div>
            </div>
            
        
            {% for p in productos %}
            <div class="">
                <div class="flex">
                    <input type="number" step="0.01" step-my  name="producto-id" class="hidden" value="{{p.producto.id}}" required>
                    <div class="flex w-1/3">
                        <div class="w-2/5 border h-full text-sm text-center flex items-center justify-center">
                            <span class="w-full text-center items-center">{{p.producto.codigo}}</span>
                        </div>
                        <span class="w-2/5 border h-full text-sm text-center flex items-center justify-center">{{p.producto.nombre}}</span>
                        <span class="w-1/5 border h-full text-sm text-center flex items-center justify-center">{{p.producto.medida}}</span>
                    </div>
                    <div class="flex w-1/3">
                        <div class="flex w-1/2 h-full">
                            
                            <div class="flex w-1/2 border">
                                <span class="text-red-700 mr-2">*</span>
                                <input type="number" step="0.01" step-my  id="cantiad-{{p.id}}" placeholder="0" name="cantidad" step="0.01" class="item-form bg-transparent border-0 text-md  block w-full p-0.5 focus:ring-0 appearance-none focus:outline-none focus:ring-0 " 
                                oninput="changeCantRemitida({{p.id}},{{p.precio_venta|parseFloat}})"
                                min=0 max={{p.cantidad_actual|parseFloat}} value-previus=0>
                            </div>
                            <span class="w-1/2 border h-full text-sm text-center flex items-center justify-center">-</span>
                        </div>
                        <div class="flex w-1/2 h-full">
                            {% with p.precio_venta|toMoneyList as precio_venta_list %}
                            <span class="w-2/3 border h-full text-sm text-center flex items-center justify-center">{{precio_venta_list.0}}</span>
                            <span class="w-1/3 border h-full text-sm text-center flex items-center justify-center">{{precio_venta_list.1}}</span>
                            {% endwith %}
                        </div>
                    </div>
                    <div class="flex w-1/3">
                        <div class="flex w-2/3 h-full">
                            <div class="flex w-1/2 h-full">
                                <span class="w-2/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                                <span class="w-1/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                            </div>
                            <div class="flex w-1/2 h-full">
                                <span class="w-2/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                                <span class="w-1/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                            </div>
                        </div>
                        <span class="w-1/3 border h-full text-sm text-center flex items-center justify-center" id="existencia-{{p.id}}">{{p.cantidad_actual|parseFloat}}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
            
            <div class="flex">
                <span class="w-2/3 px-2.5 border">Importe total</span>
                <div class="flex w-1/3 border">
                    <div class="flex w-2/3 h-full">
                        <div class="flex w-1/2 h-full">
                            <span class="w-2/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                            <span class="w-1/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                        </div>
                        <div class="flex w-1/2 h-full">
                            <span class="w-2/3 border h-full text-sm text-center">-</span>
                            <span class="w-1/3 border h-full text-sm text-center">-</span>
                        </div>
                    </div>
                    <span class="w-1/3 border h-full text-sm text-center">-</span>
                </div>
            </div>
            
            <div class="flex">
                <div class="flex w-1/3 border h-full relative">
                    <span class="block px-2.5 pb-1 pt-3 w-full border-0 text-md font-semibold text-gray-900 bg-transparent appearance-none">Entrega</span>
                </div>
                <div class="flex w-1/3 border h-full relative">
                    <span class="block px-2.5 pb-1 pt-3 w-full border-0 text-md font-semibold text-gray-900 bg-transparent appearance-none">Recibe</span>
                </div>
                <div class="flex w-1/3 border h-full relative">
                    <span class="block px-2.5 pb-1 pt-3 w-full border-0 text-md font-semibold text-gray-900 bg-transparent appearance-none">Autoriza</span>
                </div>
            </div>
            
            <div class="flex">
                <div class="flex w-1/3 border h-full">
                    <div class="flex flex-col w-2/3 h-full border">
                        <div class="flex h-full relative">
                            <input type="text" id="nombre_entrega" name="nombre_entrega" class="block px-2.5 pb-1 pt-3 w-full border-0 text-sm text-gray-900 bg-transparent appearance-none focus:outline-none focus:ring-0 peer" placeholder=" " />
                            <label for="nombre_entrega" class="absolute text-sm duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-transparent px-2 peer-focus:px-2 peer-placeholder-shown:scale-100 
                            peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1 peer-focus:mt-1 w-full"><span class="text-red-700">*</span> Nombre</label>
                        </div>
                        <span class="h-full text-sm px-3 pb-3">Firma:</span>
                    </div>
                    <div class="flex w-1/3">
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">D</div>
                            <div class="border-t h-full text-center" id="dia_2">-</div>
                        </div>
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">M</div>
                            <div class="border-t h-full text-center" id="mes_2">-</div>
                        </div>
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">A</div>
                            <div class="border-t h-full text-center" id="anno_2">-</div>
                        </div>
                    </div>
                </div>
                <div class="flex w-1/3 border h-full">
                    <div class="flex flex-col w-2/3 h-full border">
                        <div class="flex h-full relative">
                            <input type="text" id="nombre_recibe" name="nombre_recibe" class="block px-2.5 pb-1 pt-3 w-full border-0 text-sm text-gray-900 bg-transparent appearance-none focus:outline-none focus:ring-0 peer" placeholder=" " />
                            <label for="nombre_recibe" class="absolute text-sm duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-transparent px-2 peer-focus:px-2 peer-placeholder-shown:scale-100 
                            peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1 peer-focus:mt-1 w-full"><span class="text-red-700">*</span> Nombre</label>
                        </div>
                        <span class="h-full text-sm px-3 pb-3">Firma:</span>
                    </div>
                    <div class="flex w-1/3">
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">D</div>
                            <div class="border-t h-full text-center">-</div>
                        </div>
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">M</div>
                            <div class="border-t h-full text-center">-</div>
                        </div>
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">A</div>
                            <div class="border-t h-full text-center">-</div>
                        </div>
                    </div>
                </div>
                <div class="flex w-1/3 border h-full">
                    <div class="flex flex-col w-full h-full border">
                        <div class="flex h-full relative">
                            <input type="text" id="nombre_autoriza" name="nombre_autoriza" class="block px-2.5 pb-1 pt-3 w-full border-0 text-sm text-gray-900 bg-transparent appearance-none focus:outline-none focus:ring-0 peer" placeholder=" " />
                            <label for="nombre_autoriza" class="absolute text-sm duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-transparent px-2 peer-focus:px-2 peer-placeholder-shown:scale-100 
                            peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1 peer-focus:mt-1 w-full"><span class="text-red-700">*</span> Nombre</label>
                        </div>
                        <span class="h-full text-sm px-3 pb-3">Firma:</span>
                    </div>
                </div>
            </div>

        </div>
        <div class="flex mt-3 justify-end">
            <button type="submit" class="focus:outline-none text-white bg-purple-600 hover:bg-purple-800 focus:ring-4 focus:ring-purple-300 font-medium rounded-lg text-sm px-5 py-2.5 mb-2 dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-900">Realizar Transferencia</button>
        </div>
    </form> 
    {% endif %}

    {% if subproductos|length > 0 %}
    <p class="w-full text-center font-bold">Transferir subproductos elaborados a Almacen - Otra cocina</p>
    <form method="POST" class="flex flex-col w-full max-w-6xl min-w-5xl" id="form-nueva-transferencia">
        {% csrf_token %}
        
        <input type="text" name="subproducto" value="True" class="hidden"/>
        <div class="flex flex-col bg-purple-200 shadow-md">
            <div class="flex">
                <span class="w-2/6 border h-full text-md px-2 py-1">Entidad: </br>Casa Laura S.R.L.</span>
                <span class="w-1/6 border h-full text-md px-2 py-1">Codigo: </br>50004347244</span>
                <span class="w-2/6 border h-full text-center font-bold py-1">SC-2-09 TRANSFERENCIA ENTRE </br> ALMACENES</span>
                <div class="w-1/6 border flex">
                    <div class="w-1/3 flex flex-col">
                        <div class="border-b h-full text-center font-bold">D</div>
                        <div class="h-full text-center" id="dia"></div>
                    </div>
                    <div class="w-1/3 border-l flex flex-col">
                        <div class="border-b h-full text-center font-bold">M</div>
                        <div class="h-full text-center" id="mes"></div>
                    </div>
                    <div class="w-1/3 border-l flex flex-col">
                        <div class="border-b h-full text-center font-bold">A</div>
                        <div class="h-full text-center" id="anno"></div>
                    </div>
                </div>
            </div>
            
            <div class="flex">
                <div class="px-2.5 py-1 flex w-1/3 border h-full items-center relative h-full">
                    <span class="text-red-500 mr-1">*</span>
                    Entrega:
                    <input type="text" id="emisor" name="emisor" class="hidden" value="C-{{emisor.id}}">
                    <span class="block px-2.5 w-full border-0 text-sm text-gray-900">{{emisor.nombre}}</span>

                </div>
                <span class="flex w-1/3 py-1 px-2.5 border h-full">{% if emisor.direccion %}{{ emisor.direccion }}{% else %}Dirección{% endif %}</span>
                <span class="flex w-1/3 py-1 px-2.5 border h-full">{% if emisor.codigo %}{{ emisor.codigo }}{% else %}Código{% endif %}</span>
            </div>
            
            <div class="flex">
                <div class="px-2.5 py-1 flex w-1/3 border h-full items-center relative h-full">
                    <span class="text-red-500 mr-1">*</span>
                    Recibe:                    
                    <select id="receptor" name="receptor" class="block px-2.5 w-full border-0 text-sm text-gray-900 bg-transparent appearance-none focus:outline-none focus:ring-0">
                        
                        <option disabled selected value="">Almacenes</option>
                        {% for almacen in almacenes %}
                        <option value="A-{{ almacen.id }}">{{ almacen.nombre }}</option>
                        {% endfor %}                      
                        <option disabled>Cocinas</option>
                        {% for cocina in cocinas %}
                        <option value="C-{{ cocina.id }}">{{ cocina.nombre }}</option>
                        {% endfor %}
                    </select>

                </div>
                <span class="flex w-1/3 py-1 px-2.5 border h-full">Dirección</span>
                <span class="flex w-1/3 py-1 px-2.5 border h-full">Código</span>
            </div>
            
            <div class="flex">
                <div class="flex w-1/3">
                    <span class="w-2/5 border h-full text-sm font-semibold text-center flex items-center justify-center">Código</span>
                    <span class="w-2/5 border h-full text-sm font-semibold text-center flex items-center justify-center">Descripción</span>
                    <span class="w-1/5 border h-full text-sm font-semibold text-center flex items-center justify-center">U/M</span>
                </div>
                <div class="flex w-1/3">
                    <div class="flex flex-col w-1/2 h-full">
                        <span class="w-full border h-full text-sm font-semibold text-center">Cantidad</span>
                        <div class="flex w-full h-full">
                            <span class="w-1/2 border h-full text-sm font-semibold text-center">Remitida</span>
                            <span class="w-1/2 border h-full text-sm font-semibold text-center">Recibida</span>
                        </div>
                    </div>
                    <span class="w-1/2 border h-full text-sm font-semibold text-center">Precio Unitario </br> Total o Costo </br> Predeterminado</span>
                </div>
                <div class="flex w-1/3">
                    <div class="flex flex-col w-2/3 h-full">
                        <span class="w-full border h-full text-sm font-semibold text-center">Importe</span>
                        <div class="flex w-full h-full">
                            <span class="w-1/2 border h-full text-sm font-semibold text-center">Productos</br>Remitidos</span>
                            <span class="w-1/2 border h-full text-sm font-semibold text-center">Productos</br>Recibidos</span>
                        </div>
                    </div>
                    <span class="w-1/3 border h-full text-sm font-semibold text-center flex items-center justify-center">Saldo en </br> Existencia</span>
                </div>
            </div>
            
        
            {% for p in subproductos %}
            <div class="">
                <div class="flex">
                    <input type="number" step="0.01" step-my  name="producto-id" class="hidden" value="{{p.producto.id}}" required>
                    <div class="flex w-1/3">
                        <div class="w-2/5 border h-full text-sm text-center flex items-center justify-center">
                            <span class="w-full text-center items-center">{{p.producto.codigo}}</span>
                        </div>
                        <span class="w-2/5 border h-full text-sm text-center flex items-center justify-center">{{p.producto.nombre}}</span>
                        <span class="w-1/5 border h-full text-sm text-center flex items-center justify-center">{{p.producto.medida}}</span>
                    </div>
                    <div class="flex w-1/3">
                        <div class="flex w-1/2 h-full">
                            
                            <div class="flex w-1/2 border">
                                <span class="text-red-700 mr-2">*</span>
                                <input type="number" step="0.01" step-my  id="cantiad-{{p.id}}" placeholder="0" name="cantidad" step="0.01" class="item-form bg-transparent border-0 text-md  block w-full p-0.5 focus:ring-0 appearance-none focus:outline-none focus:ring-0 " 
                                oninput="changeCantRemitida({{p.id}},{{p.precio_venta|parseFloat}})"
                                min=0 max={{p.cantidad_actual|parseFloat}} value-previus=0>
                            </div>
                            <span class="w-1/2 border h-full text-sm text-center flex items-center justify-center">-</span>
                        </div>
                        <div class="flex w-1/2 h-full">
                            <span class="w-2/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                            <span class="w-1/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                        </div>
                    </div>
                    <div class="flex w-1/3">
                        <div class="flex w-2/3 h-full">
                            <div class="flex w-1/2 h-full">
                                <span class="w-2/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                                <span class="w-1/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                            </div>
                            <div class="flex w-1/2 h-full">
                                <span class="w-2/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                                <span class="w-1/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                            </div>
                        </div>
                        <span class="w-1/3 border h-full text-sm text-center flex items-center justify-center" id="existencia-{{p.id}}">{{p.cantidad_actual|parseFloat}}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
            
            <div class="flex">
                <span class="w-2/3 px-2.5 border">Importe total</span>
                <div class="flex w-1/3 border">
                    <div class="flex w-2/3 h-full">
                        <div class="flex w-1/2 h-full">
                            <span class="w-2/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                            <span class="w-1/3 border h-full text-sm text-center flex items-center justify-center">-</span>
                        </div>
                        <div class="flex w-1/2 h-full">
                            <span class="w-2/3 border h-full text-sm text-center">-</span>
                            <span class="w-1/3 border h-full text-sm text-center">-</span>
                        </div>
                    </div>
                    <span class="w-1/3 border h-full text-sm text-center">-</span>
                </div>
            </div>
            
            <div class="flex">
                <div class="flex w-1/3 border h-full relative">
                    <span class="block px-2.5 pb-1 pt-3 w-full border-0 text-md font-semibold text-gray-900 bg-transparent appearance-none">Entrega</span>
                </div>
                <div class="flex w-1/3 border h-full relative">
                    <span class="block px-2.5 pb-1 pt-3 w-full border-0 text-md font-semibold text-gray-900 bg-transparent appearance-none">Recibe</span>
                </div>
                <div class="flex w-1/3 border h-full relative">
                    <span class="block px-2.5 pb-1 pt-3 w-full border-0 text-md font-semibold text-gray-900 bg-transparent appearance-none">Autoriza</span>
                </div>
            </div>
            
            <div class="flex">
                <div class="flex w-1/3 border h-full">
                    <div class="flex flex-col w-2/3 h-full border">
                        <div class="flex h-full relative">
                            <input type="text" id="nombre_entrega" name="nombre_entrega" class="block px-2.5 pb-1 pt-3 w-full border-0 text-sm text-gray-900 bg-transparent appearance-none focus:outline-none focus:ring-0 peer" placeholder=" " />
                            <label for="nombre_entrega" class="absolute text-sm duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-transparent px-2 peer-focus:px-2 peer-placeholder-shown:scale-100 
                            peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1 peer-focus:mt-1 w-full"><span class="text-red-700">*</span> Nombre</label>
                        </div>
                        <span class="h-full text-sm px-3 pb-3">Firma:</span>
                    </div>
                    <div class="flex w-1/3">
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">D</div>
                            <div class="border-t h-full text-center" id="dia_2">-</div>
                        </div>
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">M</div>
                            <div class="border-t h-full text-center" id="mes_2">-</div>
                        </div>
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">A</div>
                            <div class="border-t h-full text-center" id="anno_2">-</div>
                        </div>
                    </div>
                </div>
                <div class="flex w-1/3 border h-full">
                    <div class="flex flex-col w-2/3 h-full border">
                        <div class="flex h-full relative">
                            <input type="text" id="nombre_recibe" name="nombre_recibe" class="block px-2.5 pb-1 pt-3 w-full border-0 text-sm text-gray-900 bg-transparent appearance-none focus:outline-none focus:ring-0 peer" placeholder=" " />
                            <label for="nombre_recibe" class="absolute text-sm duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-transparent px-2 peer-focus:px-2 peer-placeholder-shown:scale-100 
                            peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1 peer-focus:mt-1 w-full"><span class="text-red-700">*</span> Nombre</label>
                        </div>
                        <span class="h-full text-sm px-3 pb-3">Firma:</span>
                    </div>
                    <div class="flex w-1/3">
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">D</div>
                            <div class="border-t h-full text-center">-</div>
                        </div>
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">M</div>
                            <div class="border-t h-full text-center">-</div>
                        </div>
                        <div class="w-1/3 border flex flex-col">
                            <div class="border-b h-full text-center">A</div>
                            <div class="border-t h-full text-center">-</div>
                        </div>
                    </div>
                </div>
                <div class="flex w-1/3 border h-full">
                    <div class="flex flex-col w-full h-full border">
                        <div class="flex h-full relative">
                            <input type="text" id="nombre_autoriza" name="nombre_autoriza" class="block px-2.5 pb-1 pt-3 w-full border-0 text-sm text-gray-900 bg-transparent appearance-none focus:outline-none focus:ring-0 peer" placeholder=" " />
                            <label for="nombre_autoriza" class="absolute text-sm duration-300 transform -translate-y-4 scale-75 top-2 z-10 origin-[0] bg-transparent px-2 peer-focus:px-2 peer-placeholder-shown:scale-100 
                            peer-placeholder-shown:-translate-y-1/2 peer-placeholder-shown:top-1/2 peer-focus:top-2 peer-focus:scale-75 peer-focus:-translate-y-4 left-1 peer-focus:mt-1 w-full"><span class="text-red-700">*</span> Nombre</label>
                        </div>
                        <span class="h-full text-sm px-3 pb-3">Firma:</span>
                    </div>
                </div>
            </div>

        </div>
        <div class="flex mt-3 justify-end">
            <button type="submit" class="focus:outline-none text-white bg-purple-600 hover:bg-purple-800 focus:ring-4 focus:ring-purple-300 font-medium rounded-lg text-sm px-5 py-2.5 mb-2 dark:bg-purple-600 dark:hover:bg-purple-700 dark:focus:ring-purple-900">Realizar Transferencia</button>
        </div>
    </form> 
    {% endif %}

</div>


{% endblock content %}


{% block scripts %}
<script src="{% static 'js/transferencia_almacenes.js' %}"></script>

<script>
    function setFocus(){
        setTimeout(function() { 
            document.getElementById("input-search").value = "";
            document.getElementById("input-search").focus();
        }, 150);
    }
    
    document.getElementById("form-nueva-transferencia").addEventListener("submit", function(event) {
        event.preventDefault();

        var origen = document.getElementById("emisor").value;
        var destino = document.getElementById("receptor").value;
              
        if (origen == destino) {
          alert("Debe seleccionar otro receptor");
          return false;
        }      
        this.submit();
    });
    
    document.addEventListener("keydown", function(event) {
        if (event.key === "Enter" || event.key === "ArrowUp" || event.key === "ArrowDown" || event.key === "ArrowRight" || event.key === "ArrowLeft") {
            var element = event.target;
            var next;

            
            if (event.key === "Enter" || event.key === "ArrowRight" || event.key === "ArrowDown"){next = 1} 
            else if (event.key === "ArrowLeft" || event.key === "ArrowUp"){next = -1} 
            
            if (element.tagName === "INPUT" || element.tagName === "BUTTON") {
                event.preventDefault();
        
                var form = element.form;
                var elements = form.getElementsByClassName("item-form");
                var index = Array.prototype.indexOf.call(elements, element);
                var nextElement;
        
                if (index === elements.length - 1) {
                nextElement = elements[0];
                } else {
                nextElement = elements[index + next];
                }
        
                if (nextElement) {
                nextElement.focus();
                if (nextElement.tagName === "INPUT") {
                    nextElement.select(); // seleccionar el texto del próximo elemento
                }
                }
            }
        }
    });

    function changeCantRemitida(id,precio){
        let input = document.getElementById(`cantiad-${id}`);
        //input.value = parseFloat(input.value);
    
        if( input.value < parseFloat(input.getAttribute("min")) ){
            input.value = input.getAttribute("min");
        }
        else if( input.value > parseFloat(input.getAttribute("max")) ){
            input.value = input.getAttribute("max");
        }
        
        var valorPrevio = input.getAttribute('value-previus');
    
        let val_cant = input.value;
        if(val_cant == ""){val_cant = 0;}
    
        let existencia_element = document.getElementById(`existencia-${id}`)
        var existencia = parseFloat(existencia_element.textContent) + parseFloat(valorPrevio) - parseFloat(val_cant);
        
        if( existencia.toString() == "NaN" ){
            existencia = existencia_element.getAttribute("existencia-almacen");
        }
    
        existencia_element.textContent = existencia;    
        input.setAttribute('value-previus',val_cant);    
    }
    
    
    var fecha = new Date();
    document.getElementById("dia").innerHTML = fecha.getDate();
    document.getElementById("mes").innerHTML = fecha.getMonth() + 1;
    document.getElementById("anno").innerHTML = fecha.getFullYear();
    document.getElementById("dia_2").innerHTML = fecha.getDate();
    document.getElementById("mes_2").innerHTML = fecha.getMonth() + 1;
    document.getElementById("anno_2").innerHTML = fecha.getFullYear();
</script>

{% endblock scripts %}